<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Accountability App</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
        min-height: 100vh;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(255, 255, 255, 0.18);
        text-align: center;
      }

      .header h1 {
        color: #2c3e50;
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .status-indicator {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 25px;
        font-weight: bold;
        margin: 10px 5px;
      }

      .status-checked-in {
        background: #27ae60;
        color: white;
      }

      .status-checked-out {
        background: #e74c3c;
        color: white;
      }

      .status-monitoring {
        background: #f39c12;
        color: white;
      }

      .card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      .card h2 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.5rem;
      }

      .button-group {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        flex: 1;
        min-width: 120px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
      }

      .btn-success {
        background: linear-gradient(135deg, #27ae60, #229954);
        color: white;
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
      }

      .btn-danger {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
      }

      .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
      }

      .btn-warning {
        background: linear-gradient(135deg, #f39c12, #e67e22);
        color: white;
      }

      .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
      }

      .input-group {
        margin-bottom: 15px;
      }

      .input-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #2c3e50;
      }

      .input-group input,
      .input-group textarea,
      .input-group select {
        width: 100%;
        padding: 10px;
        border: 2px solid #bdc3c7;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .input-group input:focus,
      .input-group textarea:focus,
      .input-group select:focus {
        outline: none;
        border-color: #3498db;
      }

      .log-area {
        background: #2c3e50;
        color: #ecf0f1;
        border-radius: 8px;
        padding: 15px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
        margin-top: 10px;
      }

      .restricted-apps {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }

      .app-tag {
        background: #e8f4fd;
        color: #2980b9;
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .app-tag .remove-btn {
        background: #e74c3c;
        color: white;
        border: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .time-display {
        font-size: 1.2rem;
        font-weight: bold;
        color: #2c3e50;
        text-align: center;
        margin: 10px 0;
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .alert-danger {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }

        .button-group {
          flex-direction: column;
        }

        .btn {
          min-width: auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üéØ Accountability Tracker</h1>
        <div class="status-indicators">
          <span id="statusIndicator" class="status-indicator status-checked-out"
            >Not Checked In</span
          >
          <span
            id="monitoringIndicator"
            class="status-indicator status-monitoring"
            style="display: none"
            >Monitoring Active</span
          >
        </div>
        <div class="time-display" id="currentTime"></div>
      </div>

      <div class="grid">
        <div class="card">
          <h2>‚è∞ Daily Check-in/Out</h2>
          <div class="button-group">
            <button class="btn btn-success" onclick="checkIn()">
              Check In
            </button>
            <button class="btn btn-danger" onclick="checkOut()">
              Check Out
            </button>
          </div>
          <div id="checkInStatus"></div>

          <div class="input-group">
            <label>Check-in Time (24h format):</label>
            <input type="time" id="checkInTime" value="08:00" />
          </div>

          <div class="input-group">
            <label>Check-out Time (24h format):</label>
            <input type="time" id="checkOutTime" value="16:00" />
          </div>
        </div>

        <div class="card">
          <h2>üö´ Restricted Applications</h2>
          <div class="input-group">
            <label>Add Application (e.g., "chrome.exe", "steam.exe"):</label>
            <input
              type="text"
              id="newApp"
              placeholder="Enter application name"
            />
            <button
              class="btn btn-primary"
              onclick="addRestrictedApp()"
              style="margin-top: 10px"
            >
              Add App
            </button>
          </div>

          <div class="restricted-apps" id="restrictedApps"></div>

          <div class="input-group" style="margin-top: 15px">
            <label>Keywords to Monitor (YouTube, Netflix, etc.):</label>
            <input type="text" id="newKeyword" placeholder="Enter keyword" />
            <button
              class="btn btn-primary"
              onclick="addKeyword()"
              style="margin-top: 10px"
            >
              Add Keyword
            </button>
          </div>

          <div class="restricted-apps" id="keywords"></div>
        </div>
      </div>

      <div class="card">
        <h2>üí¨ Discord Notifications</h2>
        <div class="input-group">
          <label>Discord Webhook URL:</label>
          <input
            type="url"
            id="discordWebhook"
            placeholder="https://discord.com/api/webhooks/..."
          />
        </div>

        <div class="button-group">
          <button class="btn btn-primary" onclick="testDiscordNotification()">
            Test Notification
          </button>
          <button class="btn btn-warning" onclick="saveSettings()">
            Save Settings
          </button>
        </div>

        <div id="discordStatus"></div>
      </div>

      <div class="card">
        <h2>‚öôÔ∏è Monitoring Controls</h2>
        <div class="button-group">
          <button class="btn btn-success" onclick="startMonitoring()">
            Start Monitoring
          </button>
          <button class="btn btn-danger" onclick="stopMonitoring()">
            Stop Monitoring
          </button>
          <button class="btn btn-warning" onclick="pauseMonitoring()">
            Pause (1 hour)
          </button>
        </div>

        <div class="input-group">
          <label>Temporary Disable (minutes):</label>
          <input
            type="number"
            id="disableMinutes"
            value="60"
            min="1"
            max="480"
          />
          <button
            class="btn btn-warning"
            onclick="temporaryDisable()"
            style="margin-top: 10px"
          >
            Disable Temporarily
          </button>
        </div>

        <div id="monitoringStatus"></div>
      </div>

      <div class="card">
        <h2>üìä Activity Log</h2>
        <div class="button-group">
          <button class="btn btn-primary" onclick="clearLog()">
            Clear Log
          </button>
          <button class="btn btn-primary" onclick="exportLog()">
            Export Log
          </button>
          <button class="btn btn-warning" onclick="checkForUpdates()">
            Check for Updates
          </button>
        </div>
        <div class="log-area" id="activityLog"></div>
      </div>
    </div>

    <script>
      // Application State
      let isCheckedIn = false;
      let isMonitoring = false;
      let restrictedApps = ["chrome.exe", "firefox.exe", "steam.exe"];
      let monitoringKeywords = ["youtube", "netflix", "twitch"];
      let activityLog = [];
      let monitoringInterval = null;
      let settings = {
        discordWebhook: "",
        checkInTime: "08:00",
        checkOutTime: "16:00",
        restrictedApps: ["chrome.exe", "firefox.exe", "steam.exe"],
        monitoringKeywords: ["youtube", "netflix", "twitch"],
      };

      // Initialize the application
      window.addEventListener("DOMContentLoaded", async () => {
        await loadSettings();
        updateDisplay();
        updateTime();
        setInterval(updateTime, 1000);

        // Set up Electron event listeners
        window.electronAPI.onViolationDetected(handleViolationDetected);
        window.electronAPI.onTriggerCheckin(() => checkIn());
        window.electronAPI.onTriggerCheckout(() => checkOut());
        window.electronAPI.onRequestQuitReason(handleQuitRequest);

        // Auto-updater event listeners
        window.electronAPI.onUpdateAvailable(handleUpdateAvailable);
        window.electronAPI.onDownloadProgress(handleDownloadProgress);
        window.electronAPI.onUpdateDownloaded(handleUpdateDownloaded);

        // Auto-start monitoring if within work hours
        if (isWithinWorkHours()) {
          await startMonitoring();
        }

        // Check current monitoring status
        isMonitoring = await window.electronAPI.getMonitoringStatus();
        updateDisplay();
      });

      function handleViolationDetected(data) {
        const apps = data.apps || [];
        const keywords = data.keywords || [];
        const allViolations = data.allViolations || [];

        let message = "üö® Violation detected: ";
        if (apps.length > 0 && keywords.length > 0) {
          message += `Apps: ${apps.join(", ")}, Content: ${keywords.join(", ")}`;
        } else if (apps.length > 0) {
          message += `Restricted apps: ${apps.join(", ")}`;
        } else if (keywords.length > 0) {
          message += `Restricted content: ${keywords.join(", ")}`;
        } else {
          message += allViolations.join(", ");
        }

        addToLog(message);
        showAlert(message, "danger");
      }

      async function handleQuitRequest() {
        const reason = prompt(
          "Please explain why you're quitting the accountability app:"
        );
        if (reason === null) return; // User cancelled
        if (reason.trim() === "") {
          showAlert("Please provide a reason for quitting the app", "warning");
          return;
        }

        await window.electronAPI.quitAppWithReason(reason.trim());
      }

      // Auto-updater handlers
      function handleUpdateAvailable(info) {
        showAlert(
          "üîÑ Update available! Version " + info.version + " is downloading...",
          "success"
        );
        addToLog("üì¶ Update available: " + info.version);
      }

      function handleDownloadProgress(progress) {
        const percent = Math.round(progress.percent);
        updateDownloadProgress(percent);
      }

      function handleUpdateDownloaded(info) {
        showUpdateReadyDialog(info);
      }

      function updateDownloadProgress(percent) {
        let progressElement = document.getElementById("updateProgress");
        if (!progressElement) {
          progressElement = document.createElement("div");
          progressElement.id = "updateProgress";
          progressElement.className = "alert alert-success";
          progressElement.innerHTML = `
            <div>üì• Downloading update...</div>
            <div style="background: #ddd; border-radius: 4px; margin-top: 8px;">
              <div id="progressBar" style="background: #27ae60; height: 20px; border-radius: 4px; width: 0%; transition: width 0.3s;"></div>
            </div>
            <div id="progressText" style="margin-top: 4px; font-size: 12px;">0%</div>
          `;
          const container = document.querySelector(".container");
          const firstCard = container.querySelector(".card");
          container.insertBefore(progressElement, firstCard);
        }

        const progressBar = document.getElementById("progressBar");
        const progressText = document.getElementById("progressText");
        if (progressBar && progressText) {
          progressBar.style.width = percent + "%";
          progressText.textContent = percent + "%";
        }
      }

      function showUpdateReadyDialog(info) {
        const progressElement = document.getElementById("updateProgress");
        if (progressElement) {
          progressElement.remove();
        }

        const updateDialog = document.createElement("div");
        updateDialog.className = "alert alert-success";
        updateDialog.innerHTML = `
          <div style="margin-bottom: 15px;">
            <strong>üéâ Update Ready!</strong><br>
            Version ${info.version} has been downloaded and is ready to install.
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-success" onclick="installUpdate()" style="flex: 1;">
              Install Now & Restart
            </button>
            <button class="btn btn-primary" onclick="dismissUpdate(this)" style="flex: 1;">
              Install Later
            </button>
          </div>
        `;

        const container = document.querySelector(".container");
        const firstCard = container.querySelector(".card");
        container.insertBefore(updateDialog, firstCard);

        addToLog("‚úÖ Update downloaded and ready to install: " + info.version);
      }

      async function installUpdate() {
        addToLog("üîÑ Installing update and restarting app...");
        await window.electronAPI.installUpdate();
      }

      function dismissUpdate(button) {
        button.closest(".alert").remove();
        addToLog("‚è∞ Update installation postponed");
      }

      async function checkForUpdates() {
        addToLog("üîç Manually checking for updates...");
        showAlert("Checking for updates...", "success");
        await window.electronAPI.checkForUpdates();
      }
      function updateTime() {
        const now = new Date();
        document.getElementById("currentTime").textContent =
          now.toLocaleString();
      }

      function isWithinWorkHours() {
        const now = new Date();
        const currentTime = now.getHours() * 60 + now.getMinutes();
        const checkIn = timeToMinutes(settings.checkInTime);
        const checkOut = timeToMinutes(settings.checkOutTime);
        return currentTime >= checkIn && currentTime <= checkOut;
      }

      function timeToMinutes(timeStr) {
        const [hours, minutes] = timeStr.split(":").map(Number);
        return hours * 60 + minutes;
      }

      async function checkIn() {
        isCheckedIn = true;
        const now = new Date();
        const message = `‚úÖ Checked in at ${now.toLocaleTimeString()}`;
        addToLog(message);
        await window.electronAPI.sendDiscordMessage(
          `üéØ **Check-in Alert**\n${message}`
        );
        updateDisplay();
        await startMonitoring();
        showAlert("Successfully checked in!", "success");
      }

      async function checkOut() {
        isCheckedIn = false;
        const now = new Date();
        const message = `‚è∞ Checked out at ${now.toLocaleTimeString()}`;
        addToLog(message);
        await window.electronAPI.sendDiscordMessage(
          `üèÅ **Check-out Alert**\n${message}`
        );
        updateDisplay();
        await stopMonitoring();
        showAlert("Successfully checked out!", "success");
      }

      async function addRestrictedApp() {
        const appInput = document.getElementById("newApp");
        const appName = appInput.value.trim();

        if (appName && !restrictedApps.includes(appName)) {
          restrictedApps.push(appName);
          settings.restrictedApps = restrictedApps;
          await window.electronAPI.saveSettings(settings);
          appInput.value = "";
          updateDisplay();
          addToLog(`Added restricted app: ${appName}`);
          showAlert(`Added "${appName}" to restricted applications`, "success");
        }
      }

      async function addKeyword() {
        const keywordInput = document.getElementById("newKeyword");
        const keyword = keywordInput.value.trim().toLowerCase();

        if (keyword && !monitoringKeywords.includes(keyword)) {
          monitoringKeywords.push(keyword);
          settings.monitoringKeywords = monitoringKeywords;
          await window.electronAPI.saveSettings(settings);
          keywordInput.value = "";
          updateDisplay();
          addToLog(`Added monitoring keyword: ${keyword}`);
          showAlert(`Added "${keyword}" to monitoring keywords`, "success");
        }
      }

      async function removeRestrictedApp(app) {
        restrictedApps = restrictedApps.filter((a) => a !== app);
        settings.restrictedApps = restrictedApps;
        await window.electronAPI.saveSettings(settings);
        updateDisplay();
        addToLog(`Removed restricted app: ${app}`);
      }

      async function removeKeyword(keyword) {
        monitoringKeywords = monitoringKeywords.filter((k) => k !== keyword);
        settings.monitoringKeywords = monitoringKeywords;
        await window.electronAPI.saveSettings(settings);
        updateDisplay();
        addToLog(`Removed keyword: ${keyword}`);
      }

      async function startMonitoring() {
        if (isMonitoring) return;

        const success = await window.electronAPI.startMonitoring();
        if (success) {
          isMonitoring = true;
          addToLog("üîç Monitoring started");
          updateDisplay();
          showAlert("Monitoring started successfully!", "success");
        } else {
          showAlert("Failed to start monitoring", "danger");
        }
      }

      async function stopMonitoring() {
        if (!isMonitoring) return;

        // Ask for reason
        const reason = prompt("Please explain why you're stopping monitoring:");
        if (reason === null) return; // User cancelled
        if (reason.trim() === "") {
          showAlert(
            "Please provide a reason for stopping monitoring",
            "warning"
          );
          return;
        }

        const success = await window.electronAPI.stopMonitoringWithReason(
          reason.trim()
        );
        if (success !== undefined) {
          isMonitoring = false;
          addToLog(`‚èπÔ∏è Monitoring stopped - Reason: ${reason.trim()}`);
          updateDisplay();
          showAlert("Monitoring stopped", "warning");
        }
      }

      async function pauseMonitoring() {
        if (!isMonitoring) return;

        // Ask for reason
        const reason = prompt("Please explain why you're pausing monitoring:");
        if (reason === null) return; // User cancelled
        if (reason.trim() === "") {
          showAlert(
            "Please provide a reason for pausing monitoring",
            "warning"
          );
          return;
        }

        const minutes = 60; // 1 hour pause
        const success = await window.electronAPI.pauseMonitoringWithReason(
          reason.trim(),
          minutes
        );
        if (success) {
          isMonitoring = false;
          addToLog(
            `‚è∏Ô∏è Monitoring paused for ${minutes} minutes - Reason: ${reason.trim()}`
          );
          updateDisplay();

          setTimeout(
            async () => {
              if (isWithinWorkHours()) {
                await startMonitoring();
                addToLog("‚ñ∂Ô∏è Monitoring resumed automatically");
              }
            },
            minutes * 60 * 1000
          );

          showAlert(`Monitoring paused for ${minutes} minutes`, "warning");
        }
      }

      async function temporaryDisable() {
        const minutes =
          parseInt(document.getElementById("disableMinutes").value) || 60;

        // Ask for reason
        const reason = prompt(
          `Please explain why you're disabling monitoring for ${minutes} minutes:`
        );
        if (reason === null) return; // User cancelled
        if (reason.trim() === "") {
          showAlert(
            "Please provide a reason for disabling monitoring",
            "warning"
          );
          return;
        }

        const success = await window.electronAPI.pauseMonitoringWithReason(
          reason.trim(),
          minutes
        );
        if (success) {
          isMonitoring = false;
          addToLog(
            `üö´ Monitoring disabled for ${minutes} minutes - Reason: ${reason.trim()}`
          );
          updateDisplay();

          setTimeout(
            async () => {
              if (isWithinWorkHours()) {
                await startMonitoring();
                addToLog("‚úÖ Monitoring re-enabled automatically");
              }
            },
            minutes * 60 * 1000
          );

          showAlert(
            `Monitoring temporarily disabled for ${minutes} minutes`,
            "warning"
          );
        }
      }

      async function testDiscordNotification() {
        const webhook = document.getElementById("discordWebhook").value;
        if (!webhook) {
          showAlert("Please enter a Discord webhook URL first", "danger");
          return;
        }

        try {
          const success = await window.electronAPI.testDiscordWebhook(webhook);
          if (success) {
            showAlert("Test notification sent successfully!", "success");
            addToLog("‚úÖ Discord test notification sent");
          } else {
            showAlert("Failed to send test notification", "danger");
            addToLog("‚ùå Discord test notification failed");
          }
        } catch (error) {
          showAlert("Error testing Discord webhook", "danger");
          addToLog(`‚ùå Discord test error: ${error.message}`);
        }
      }

      async function saveSettings() {
        settings.discordWebhook =
          document.getElementById("discordWebhook").value;
        settings.checkInTime = document.getElementById("checkInTime").value;
        settings.checkOutTime = document.getElementById("checkOutTime").value;
        settings.restrictedApps = restrictedApps;
        settings.monitoringKeywords = monitoringKeywords;

        try {
          await window.electronAPI.saveSettings(settings);
          addToLog("üíæ Settings saved");
          showAlert("Settings saved successfully!", "success");
        } catch (error) {
          showAlert("Failed to save settings", "danger");
          addToLog(`‚ùå Settings save error: ${error.message}`);
        }
      }

      async function loadSettings() {
        try {
          const loadedSettings = await window.electronAPI.getSettings();
          settings = { ...settings, ...loadedSettings };

          if (settings.restrictedApps) {
            restrictedApps = settings.restrictedApps;
          }

          if (settings.monitoringKeywords) {
            monitoringKeywords = settings.monitoringKeywords;
          }

          // Update UI with loaded settings
          document.getElementById("discordWebhook").value =
            settings.discordWebhook || "";
          document.getElementById("checkInTime").value =
            settings.checkInTime || "08:00";
          document.getElementById("checkOutTime").value =
            settings.checkOutTime || "16:00";

          addToLog("üì• Settings loaded");
        } catch (error) {
          console.error("Error loading settings:", error);
          addToLog("‚ö†Ô∏è Failed to load settings, using defaults");
        }
      }

      function addToLog(message) {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${message}`;
        activityLog.unshift(logEntry);

        // Keep only last 100 entries
        if (activityLog.length > 100) {
          activityLog = activityLog.slice(0, 100);
        }

        updateLogDisplay();
      }

      function updateLogDisplay() {
        const logArea = document.getElementById("activityLog");
        logArea.innerHTML = activityLog.join("\n");
        logArea.scrollTop = 0; // Scroll to top (newest entries)
      }

      function clearLog() {
        activityLog = [];
        updateLogDisplay();
        showAlert("Activity log cleared", "success");
      }

      function exportLog() {
        const logText = activityLog.join("\n");
        const blob = new Blob([logText], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `accountability-log-${new Date().toISOString().split("T")[0]}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showAlert("Log exported successfully!", "success");
      }

      function updateDisplay() {
        // Update status indicator
        const statusIndicator = document.getElementById("statusIndicator");
        const monitoringIndicator = document.getElementById(
          "monitoringIndicator"
        );

        if (isCheckedIn) {
          statusIndicator.textContent = "Checked In";
          statusIndicator.className = "status-indicator status-checked-in";
        } else {
          statusIndicator.textContent = "Not Checked In";
          statusIndicator.className = "status-indicator status-checked-out";
        }

        if (isMonitoring) {
          monitoringIndicator.style.display = "inline-block";
          monitoringIndicator.textContent = "Monitoring Active";
        } else {
          monitoringIndicator.style.display = "none";
        }

        // Update restricted apps display
        const appsContainer = document.getElementById("restrictedApps");
        appsContainer.innerHTML = restrictedApps
          .map(
            (app) =>
              `<div class="app-tag">${app} <button class="remove-btn" onclick="removeRestrictedApp('${app}')">√ó</button></div>`
          )
          .join("");

        // Update keywords display
        const keywordsContainer = document.getElementById("keywords");
        keywordsContainer.innerHTML = monitoringKeywords
          .map(
            (keyword) =>
              `<div class="app-tag">${keyword} <button class="remove-btn" onclick="removeKeyword('${keyword}')">√ó</button></div>`
          )
          .join("");
      }

      function showAlert(message, type) {
        // Create alert element
        const alert = document.createElement("div");
        alert.className = `alert alert-${type}`;
        alert.textContent = message;

        // Insert at top of container
        const container = document.querySelector(".container");
        const firstCard = container.querySelector(".card");
        container.insertBefore(alert, firstCard);

        // Remove after 3 seconds
        setTimeout(() => {
          if (alert.parentNode) {
            alert.parentNode.removeChild(alert);
          }
        }, 3000);
      }

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey) {
          switch (e.key) {
            case "i":
              e.preventDefault();
              checkIn();
              break;
            case "o":
              e.preventDefault();
              checkOut();
              break;
            case "s":
              e.preventDefault();
              saveSettings();
              break;
          }
        }
      });

      // Auto check-in/out based on time
      setInterval(async () => {
        const now = new Date();
        const currentTime = now.getHours() * 60 + now.getMinutes();
        const checkIn = timeToMinutes(settings.checkInTime);
        const checkOut = timeToMinutes(settings.checkOutTime);

        if (currentTime === checkIn && !isCheckedIn) {
          addToLog("üîî Auto check-in triggered");
          await checkIn();
        } else if (currentTime === checkOut && isCheckedIn) {
          addToLog("üîî Auto check-out triggered");
          await checkOut();
        }
      }, 60000); // Check every minute
    </script>
  </body>
</html>
